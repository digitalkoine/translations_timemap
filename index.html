<html>
  <head>
    <meta charset='utf-8' />
      <!--Set the name of the webpage as it appears in the browser tab-->
      <title>Prismatic Jane Eyre Time Map</title>
      <!--Describe metadata within an HTML document-->
      <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
      <!--leaflet.css is the stylesheet for Leaflet, it is retrieved from a Content Delivery Network (CDN)-->
      <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css" />
      <!--leaflet.js is the javascript code for Leaflet, it is retrieved from a Content Delivery Network (CDN)-->
      <script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js"></script>
      <!--Leaflet.Coordinates-0.1.5.min.js is the leaflet plugin used to show the mouse coordinates. For info check https://github.com/MrMufflon/Leaflet.Coordinates for additional info-->
      <script type="text/javascript" src="./js/Leaflet.Coordinates-0.1.5.min.js"></script>
      <!--Leaflet.Coordinates-0.1.5.min.js is the stylesheet of the Leaflet Coordinate plugin. For info check https://github.com/MrMufflon/Leaflet.Coordinates for additional info-->
	    <link rel="stylesheet" href="./css/Leaflet.Coordinates-0.1.5.css"/>
      <!--Autolinker.min.js is javascript script that is used in popup generated by qgis2web plugin of Qgis. It manages autolinks, i.e. automatic hyperlinking, when a predetermined set of keywords is automatically turned into hyperlinks. For info check https://github.com/gregjacobs/Autolinker.js/-->
      <script src="js/Autolinker.min.js"></script>
      <!--The iso8601.min.js is a javascript library for parsing of ISO 8601 durations. Takes a ISO 8601 formatted duration and returns an array with 6 elements, one per unit.
      The order of the units, starting with the first element of the array, is “year”, “month”, "week", “day”, “hour”, “minute”, “second”.
      It is retrieved from a Content Delivery Network (CDN). Check https://github.com/nezasa/iso8601-js-period-->
      <script type="text/javascript" src="./js/iso8601-js-period-master/iso8601.js"></script>
      <!--leaflet plugin to incorporate time capability and the time slider, check https://github.com/socib/Leaflet.TimeDimension-->
      <script type="text/javascript" src="https://cdn.rawgit.com/socib/Leaflet.TimeDimension/master/dist/leaflet.timedimension.min.js"></script>
      <link rel="stylesheet" href="https://cdn.rawgit.com/socib/Leaflet.TimeDimension/master/dist/leaflet.timedimension.control.min.css" />
      <!--<script type="text/javascript" src="./js/Leaflet.TimeDimension-master/dist/leaflet.timedimension.min.js"></script>
      <link rel="stylesheet" href="./js/Leaflet.TimeDimension-master/dist/leaflet.timedimension.control.min.css"/>-->
      <!--publications.geojson is the publication layer. It is outputted by qgis2web. The time attribute should be in a "dd/mm/yyyy hh:mm" format -->
      <script src="./data/publications.geojson" type="text/javascript"></script>
      <!--countries.geojson is the country layer. It is outputted by qgis2web-->
      <script src="./data/countries.geojson" type="text/javascript"></script>
      <!--MapStyle.css includes the css style for the text tags and ids element that can be used to format text -->
      <link rel="stylesheet" href="./css/MapStyle.css"/>
      <!--style_publications.js includes the style for both layers in the map. The code is as outputted by qgis2web for the different layers-->
      <script type="text/javascript" src="./js/layer_style.js"></script>
  </head>
  <body>
    <div id='map'></div>
    <script>
      var map = L.map('map',  {
        //ensures the timeDimension is active
        timeDimension: true,
        //Defines the timeDimension Option
        timeDimensionOptions: {
          //determines the starting and finishing times of the slider, and the period of each step.
          timeInterval: "1840-01-01/2022-01-01",
          //P1D means Period 1 Day, P1Y means Period 1 Years and so on.It is the step increment when the fast forward and fast backward buttons are clicked.
          period: "P1Y",
        },
        //Automatically adds a TimeDimension Control to the map if set to true.
        timeDimensionControl: true,
        //Defines the TimeDimension control options and elements
        timeDimensionControlOptions: {
          //position on the map of the TimeDImension control
          position: 'bottomleft',
          // adds a loop Button
          loopButton: 'true',
          //Show or hide the date in the TimeDimension Control
          displayDate: false,
          //if the slider starts automatically when opening the map
          autoPlay: true,
          //minimum speed of the time progression. It is controlled by a slider in the control
          minSpeed: 1,
          //maximum speed of the time progression. It is controlled by a slider in the control
          maxSpeed: 20,
          //introduce the whiskers that limits the time period
          limitSliders: true,
          // if true, when drag the slider it instantly updated the map
          timeSliderDragUpdate: true,
          // This are option for the TimeDimension Player.
          playerOptions: {
            //Milliseconds that the player will wait to check and launch the next time in the TimeDimension
            transitionTime: 400,
            //the map automacally restart when finished if the option is true
            loop: false,
            // the startover button is present if the option is true
            startOver:true,
          }
        }
      }).setView([41.6, 8.857524], 2);
      //This calls the tiles that will be used as basemap for the map. Different types and style of basemap are available
      L.tileLayer(
          'http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
          //Controls the max zoom of the app
          maxZoom: 22,
          attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, '
            + '<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, '
            + 'Imagery © <a href="http://mapbox.com">Mapbox</a>',
        }
      ).addTo(map);
      //this are options for the mouse coordinate box
      L.control.coordinates({
        position:"bottomleft",
        decimals:2,
        decimalSeperator:",",
        labelTemplateLat:  "Latitude: {y}",
        labelTemplateLng:  "Longitude: {x}"
      }).addTo(map);
      //n Leaflet, map panes group layers together implicitly, without the developer knowing about it. This grouping allows web browsers to work with several layers at once in a more efficient way than working with layers individually.
      map.createPane('pane_pointstranslation_novariable_1');
      // Map panes use the z-index CSS property to always show some layers on top of others
      // The pane name (in this case pane_pointstranslation_novariable_1) is assigned to
      // each case of style_publication.js using the special key pane. In this way, specific symbols might be given a specific pane
      // getPane retrieved a specific pane and assign it a zIndex adn a blend mode
      map.getPane('pane_pointstranslation_novariable_1').style.zIndex = 401;
      map.getPane('pane_pointstranslation_novariable_1').style['mix-blend-mode'] = 'normal'

      //We start to create a number of functions that are called for each feature, using onEachFeature, within the L.geoJSON definition of var jsonLayerPublications
      // We first define the highlightFeature funciton, that will be called on mouseover
      function highlightFeature(event) {
      	//target is an event property which returns the element that triggered the event
      	var hoveredLayer = event.target;
      	//set the new style that will be passed to the element that triggered the event
      	hoveredLayer.setStyle({
      		    opacity: 1,
              color: 'rgba(35,35,35,1.0)',
              dashArray: '',
              lineCap: 'butt',
              lineJoin: 'miter',
              weight: 3,
              fill: true,
              fillOpacity: 1,
              fillColor: 'rgba(255,255,0,1.0)',
              interactive: true,
              radius:7.5
      		});
      	// brings the layer to the top of all other layers
      	hoveredLayer.bringToFront();
      };

      // Lastly, we define the resetHighlight functions, that will be called on mouseout
      function resetHighlight(event) {
	       //resetStyle is a geojson method that resets the given vector layer's style to the original GeoJSON style, useful for resetting style after hover events.
	       //The geojson layer must have been declared within a variable before this
	       jsonLayerPublications.resetStyle(event.target);
      };

      //this package all the above together in a single function, which is later used as value for the onEachFeature key within the L.geoJSON definition of var jsonLayerPublications
      function eventHandlerOnEachFeature(feature, layer) {
	        //takes a layer (or another object) and assigns to it one or more event (a list is available here https://developer.mozilla.org/en-US/docs/Web/Events#event_index)
	        // with the respective event handler (the function to run when the event fires)
          layer.on({
		           'mouseover': highlightFeature,
		           'mouseout': resetHighlight
	         });
          //this create the popup for each feature in the layer, calling the properties of the feature as listed in the geoJSON
          // <strong> and </strong> indicate bold text, and <br> indicated next line. + is concatenation
          layer.bindPopup(
            '<p>'+'<strong>'+feature.properties. label_place_of_publication+'</strong>'+
            '<br>'+'Date: '+feature.properties.date+
            '<br>'+'Language: '+feature.properties.language+
            '<br>'+'Translator: '+feature.properties.translator_s+
            '<br>'+ 'Title: '+feature.properties.title+
            '<br>'+ 'Publisher: '+feature.properties.publisher+
            '<br>'+ 'Number of Printing: '+feature.properties.number_of_printings_and_or_editions+
            '<br>'+ 'Index of Translation Number (WorldCat): '+feature.properties.source__w__worldcat__it__index_translationum+'</p>'
          );
      };

      //L.geoJson allows you to parse GeoJSON data and display it on the map. The argument "publication" needs to be the variable name in the geojson.
      // the second argument are the options of the L.geoJSON (see https://docs.eegeo.com/eegeo.js/v0.1.780/docs/leaflet/L.GeoJson/#geojson-options)
      // The whole geojson, or feature class, gets a 'layer' property
      // Each feature of the feature class created by it gets a 'feature' property that links to the GeoJSON feature data the layer was created from (so that you can access its properties later).
      //Create in the index script a new function called hihglihgtFeature, whose parameter is event.
      //Create in the index script a new function called hihglihgtFeature, whose parameter is event.
      var jsonLayerPublications =  L.geoJSON(publication, {
        //set the style for the layer, using the function name present in layer_style.js
        style: style_publications,
        // This is a option, and the value assigned to the key is a function.
        // The function calls as an argument the function eventHandlerOnEachFeature and on each feature.
        onEachFeature: eventHandlerOnEachFeature,
        // pointToLayer is a function that will be used for creating layers for GeoJSON points (if not specified, simple markers will be created).
        pointToLayer: function (feature, latlng) {
          // This applies the function style_publication from the style_publications.js in the js folder containing the symbology rule,
          // which was exported directly from Qgis
          return L.circleMarker(latlng, null);
        },
      });

      map.createPane('pane_countries_0');
      // Note the pane_countries_0 zIndex is lower than the publication one, hence it appears below
      map.getPane('pane_countries_0').style.zIndex = 400;
      map.getPane('pane_countries_0').style['mix-blend-mode'] = 'normal';
      // thanks to this, the point does not appear when hovering over countries
      map.getPane('pane_countries_0').style.pointerEvents = 'none';
      var layer_countries_0 = new L.geoJson(country, {
          attribution: '',
          interactive: true,
          dataVar: 'json_countries_0',
          layerName: 'layer_countries_0',
          pane: 'pane_countries_0',
          /*onEachFeature: pop_countries_0,*/
          style: style_countries,
      });
      map.addLayer(layer_countries_0);

      // We pass the variable jsonLayerPublications, created earlier, to the timeDimension method to manage geoJSON
      var jsonLayerPublications_time = L.timeDimension.layer.geoJson(jsonLayerPublications, {
        updateTimeDimensionMode: 'union', //changing this changes the way the point appear on the map
        duration: 'P5Y',//how long the feature remains there until its time as passed
      });
      jsonLayerPublications_time.addTo(map);

      // Here we creates the legend map in the top right hand side corner.
      // baseMaps (which is empty here) is a radio button that allows to chose alternativelly between different basemaps (but only one at the time)
      // overlay are the layer that you turn on and off. The text is currently in HTML, and it is structured like a table calling the symbols from the legend folder. It is outputted directly from qgis2web
     var baseMaps = {};
     var overlay = {'See all the translations <br /><table><tr><td style="text-align: center;"><img src="legend/pointstranslation_novariable_1_Afrikaans0.png" /></td><td style="font-size:8pt">Afrikaans</td></tr><tr><td style="text-align: center;"><img src="legend/pointstranslation_novariable_1_Albanian1.png" /></td><td style="font-size:8pt">Albanian</td></tr><tr><td style="text-align: center;"><img src="legend/pointstranslation_novariable_1_Amharic2.png" /></td><td style="font-size:8pt">Amharic</td></tr><tr><td style="text-align: center;"><img src="legend/pointstranslation_novariable_1_Arabic3.png" /></td><td style="font-size:8pt">Arabic</td></tr><tr><td style="text-align: center;"><img src="legend/pointstranslation_novariable_1_Armenian4.png" /></td><td style="font-size:8pt">Armenian</td></tr><tr><td style="text-align: center;"><img src="legend/pointstranslation_novariable_1_Assamese5.png" /></td><td style="font-size:8pt">Assamese</td></tr><tr><td style="text-align: center;"><img src="legend/pointstranslation_novariable_1_Azeri6.png" /></td><td style="font-size:8pt">Azeri</td></tr><tr><td style="text-align: center;"><img src="legend/pointstranslation_novariable_1_Basque7.png" /></td><td style="font-size:8pt">Basque</td></tr><tr><td style="text-align: center;"><img src="legend/pointstranslation_novariable_1_Bengali8.png" /></td><td style="font-size:8pt">Bengali</td></tr><tr><td style="text-align: center;"><img src="legend/pointstranslation_novariable_1_Bulgarian9.png" /></td><td style="font-size:8pt">Bulgarian</td></tr><tr><td style="text-align: center;"><img src="legend/pointstranslation_novariable_1_Burmese10.png" /></td><td style="font-size:8pt">Burmese</td></tr><tr><td style="text-align: center;"><img src="legend/pointstranslation_novariable_1_Catalan11.png" /></td><td style="font-size:8pt">Catalan</td></tr><tr><td style="text-align: center;"><img src="legend/pointstranslation_novariable_1_Chinese12.png" /></td><td style="font-size:8pt">Chinese</td></tr><tr><td style="text-align: center;"><img src="legend/pointstranslation_novariable_1_Cornish13.png" /></td><td style="font-size:8pt">Cornish</td></tr><tr><td style="text-align: center;"><img src="legend/pointstranslation_novariable_1_Croatian14.png" /></td><td style="font-size:8pt">Croatian</td></tr><tr><td style="text-align: center;"><img src="legend/pointstranslation_novariable_1_Czech15.png" /></td><td style="font-size:8pt">Czech</td></tr><tr><td style="text-align: center;"><img src="legend/pointstranslation_novariable_1_Danish16.png" /></td><td style="font-size:8pt">Danish</td></tr><tr><td style="text-align: center;"><img src="legend/pointstranslation_novariable_1_Dutch17.png" /></td><td style="font-size:8pt">Dutch</td></tr><tr><td style="text-align: center;"><img src="legend/pointstranslation_novariable_1_Esperanto18.png" /></td><td style="font-size:8pt">Esperanto</td></tr><tr><td style="text-align: center;"><img src="legend/pointstranslation_novariable_1_Estonian19.png" /></td><td style="font-size:8pt">Estonian</td></tr><tr><td style="text-align: center;"><img src="legend/pointstranslation_novariable_1_Finnish20.png" /></td><td style="font-size:8pt">Finnish</td></tr><tr><td style="text-align: center;"><img src="legend/pointstranslation_novariable_1_French21.png" /></td><td style="font-size:8pt">French</td></tr><tr><td style="text-align: center;"><img src="legend/pointstranslation_novariable_1_French22.png" /></td><td style="font-size:8pt">French </td></tr><tr><td style="text-align: center;"><img src="legend/pointstranslation_novariable_1_Georgian23.png" /></td><td style="font-size:8pt">Georgian</td></tr><tr><td style="text-align: center;"><img src="legend/pointstranslation_novariable_1_German24.png" /></td><td style="font-size:8pt">German</td></tr><tr><td style="text-align: center;"><img src="legend/pointstranslation_novariable_1_Greek25.png" /></td><td style="font-size:8pt">Greek</td></tr><tr><td style="text-align: center;"><img src="legend/pointstranslation_novariable_1_Gujarati26.png" /></td><td style="font-size:8pt">Gujarati</td></tr><tr><td style="text-align: center;"><img src="legend/pointstranslation_novariable_1_Hebrew27.png" /></td><td style="font-size:8pt">Hebrew</td></tr><tr><td style="text-align: center;"><img src="legend/pointstranslation_novariable_1_Hindi28.png" /></td><td style="font-size:8pt">Hindi</td></tr><tr><td style="text-align: center;"><img src="legend/pointstranslation_novariable_1_Hungarian29.png" /></td><td style="font-size:8pt">Hungarian</td></tr><tr><td style="text-align: center;"><img src="legend/pointstranslation_novariable_1_Icelandic30.png" /></td><td style="font-size:8pt">Icelandic</td></tr><tr><td style="text-align: center;"><img src="legend/pointstranslation_novariable_1_Indonesian31.png" /></td><td style="font-size:8pt">Indonesian</td></tr><tr><td style="text-align: center;"><img src="legend/pointstranslation_novariable_1_Italian32.png" /></td><td style="font-size:8pt">Italian</td></tr><tr><td style="text-align: center;"><img src="legend/pointstranslation_novariable_1_Japanese33.png" /></td><td style="font-size:8pt">Japanese</td></tr><tr><td style="text-align: center;"><img src="legend/pointstranslation_novariable_1_Japanese34.png" /></td><td style="font-size:8pt">Japanese </td></tr><tr><td style="text-align: center;"><img src="legend/pointstranslation_novariable_1_Kannada35.png" /></td><td style="font-size:8pt">Kannada</td></tr><tr><td style="text-align: center;"><img src="legend/pointstranslation_novariable_1_Korean36.png" /></td><td style="font-size:8pt">Korean</td></tr><tr><td style="text-align: center;"><img src="legend/pointstranslation_novariable_1_Latvian37.png" /></td><td style="font-size:8pt">Latvian</td></tr><tr><td style="text-align: center;"><img src="legend/pointstranslation_novariable_1_Lithuanian38.png" /></td><td style="font-size:8pt">Lithuanian</td></tr><tr><td style="text-align: center;"><img src="legend/pointstranslation_novariable_1_Macedonian39.png" /></td><td style="font-size:8pt">Macedonian</td></tr><tr><td style="text-align: center;"><img src="legend/pointstranslation_novariable_1_Malay40.png" /></td><td style="font-size:8pt">Malay</td></tr><tr><td style="text-align: center;"><img src="legend/pointstranslation_novariable_1_Malayalam41.png" /></td><td style="font-size:8pt">Malayalam</td></tr><tr><td style="text-align: center;"><img src="legend/pointstranslation_novariable_1_Moldovan42.png" /></td><td style="font-size:8pt">Moldovan</td></tr><tr><td style="text-align: center;"><img src="legend/pointstranslation_novariable_1_Mongolian43.png" /></td><td style="font-size:8pt">Mongolian</td></tr><tr><td style="text-align: center;"><img src="legend/pointstranslation_novariable_1_Nepali44.png" /></td><td style="font-size:8pt">Nepali</td></tr><tr><td style="text-align: center;"><img src="legend/pointstranslation_novariable_1_NorthEastScots45.png" /></td><td style="font-size:8pt">North-East Scots</td></tr><tr><td style="text-align: center;"><img src="legend/pointstranslation_novariable_1_Norwegian46.png" /></td><td style="font-size:8pt">Norwegian</td></tr><tr><td style="text-align: center;"><img src="legend/pointstranslation_novariable_1_Persian47.png" /></td><td style="font-size:8pt">Persian</td></tr><tr><td style="text-align: center;"><img src="legend/pointstranslation_novariable_1_Polish48.png" /></td><td style="font-size:8pt">Polish</td></tr><tr><td style="text-align: center;"><img src="legend/pointstranslation_novariable_1_Portuguese49.png" /></td><td style="font-size:8pt">Portuguese</td></tr><tr><td style="text-align: center;"><img src="legend/pointstranslation_novariable_1_Punjabi50.png" /></td><td style="font-size:8pt">Punjabi</td></tr><tr><td style="text-align: center;"><img src="legend/pointstranslation_novariable_1_Romanian51.png" /></td><td style="font-size:8pt">Romanian</td></tr><tr><td style="text-align: center;"><img src="legend/pointstranslation_novariable_1_Romansch52.png" /></td><td style="font-size:8pt">Romansch</td></tr><tr><td style="text-align: center;"><img src="legend/pointstranslation_novariable_1_Russian53.png" /></td><td style="font-size:8pt">Russian</td></tr><tr><td style="text-align: center;"><img src="legend/pointstranslation_novariable_1_Russian54.png" /></td><td style="font-size:8pt">Russian </td></tr><tr><td style="text-align: center;"><img src="legend/pointstranslation_novariable_1_Serbian55.png" /></td><td style="font-size:8pt">Serbian</td></tr><tr><td style="text-align: center;"><img src="legend/pointstranslation_novariable_1_Sinhalese56.png" /></td><td style="font-size:8pt">Sinhalese</td></tr><tr><td style="text-align: center;"><img src="legend/pointstranslation_novariable_1_Slovak57.png" /></td><td style="font-size:8pt">Slovak</td></tr><tr><td style="text-align: center;"><img src="legend/pointstranslation_novariable_1_Slovenian58.png" /></td><td style="font-size:8pt">Slovenian</td></tr><tr><td style="text-align: center;"><img src="legend/pointstranslation_novariable_1_Spanish59.png" /></td><td style="font-size:8pt">Spanish</td></tr><tr><td style="text-align: center;"><img src="legend/pointstranslation_novariable_1_Swedish60.png" /></td><td style="font-size:8pt">Swedish</td></tr><tr><td style="text-align: center;"><img src="legend/pointstranslation_novariable_1_Tagalog61.png" /></td><td style="font-size:8pt">Tagalog</td></tr><tr><td style="text-align: center;"><img src="legend/pointstranslation_novariable_1_Tajik62.png" /></td><td style="font-size:8pt">Tajik</td></tr><tr><td style="text-align: center;"><img src="legend/pointstranslation_novariable_1_Tamil63.png" /></td><td style="font-size:8pt">Tamil</td></tr><tr><td style="text-align: center;"><img src="legend/pointstranslation_novariable_1_Thai64.png" /></td><td style="font-size:8pt">Thai</td></tr><tr><td style="text-align: center;"><img src="legend/pointstranslation_novariable_1_Tibetan65.png" /></td><td style="font-size:8pt">Tibetan</td></tr><tr><td style="text-align: center;"><img src="legend/pointstranslation_novariable_1_Turkish66.png" /></td><td style="font-size:8pt">Turkish</td></tr><tr><td style="text-align: center;"><img src="legend/pointstranslation_novariable_1_Ukrainian67.png" /></td><td style="font-size:8pt">Ukrainian</td></tr><tr><td style="text-align: center;"><img src="legend/pointstranslation_novariable_1_Urdu68.png" /></td><td style="font-size:8pt">Urdu</td></tr><tr><td style="text-align: center;"><img src="legend/pointstranslation_novariable_1_Vietnamese69.png" /></td><td style="font-size:8pt">Vietnamese</td></tr><tr><td style="text-align: center;"><img src="legend/pointstranslation_novariable_1_WestFrisian70.png" /></td><td style="font-size:8pt">West Frisian</td></tr></table>': jsonLayerPublications,
     'Countries': layer_countries_0
     }
     // This adds the control in the top right hand side with baseMaps as base maps and overlay as layers
     L.control.layers(baseMaps,overlay).addTo(map);

     // This adds the content to the country box
     var legend_countries = L.control({position: 'topleft'});
     legend_countries.onAdd = function (map) {
       var div = L.DomUtil.create('div', 'disclaimer');
       div.innerHTML +=
        'Acts of Translation<br /><table><tr><td style="text-align: center;"><img src="legend/countries_0_1130.png" /></td><td style="font-size:8pt">1 - 13 per country</td></tr><tr><td style="text-align: center;"><img src="legend/countries_0_13251.png" /></td><td style="font-size:8pt">13 - 25 per country</td></tr><tr><td style="text-align: center;"><img src="legend/countries_0_25372.png" /></td><td style="font-size:8pt">25 - 37 per country</td></tr><tr><td style="text-align: center;"><img src="legend/countries_0_37493.png" /></td><td style="font-size:8pt">37 - 49 per country</td></tr><tr><td style="text-align: center;"><img src="legend/countries_0_49614.png" /></td><td style="font-size:8pt">49 - 61 per country</td></tr><tr><td style="text-align: center;"><img src="legend/countries_0_61735.png" /></td><td style="font-size:8pt">61 - 73 per country</td></tr><tr><td style="text-align: center;"><img src="legend/countries_0_73856.png" /></td><td style="font-size:8pt">73 - 85 per country</td></tr><tr><td style="text-align: center;"><img src="legend/countries_0_85977.png" /></td><td style="font-size:8pt">85 - 97 per country</td></tr><tr><td style="text-align: center;"><img src="legend/countries_0_971098.png" /></td><td style="font-size:8pt">97 - 109 per country</td></tr></table>'
       return div;
     };
     legend_countries.addTo(map);

    //This section of the code creates the box in the bottom right hand side that display the current date, in a DD/MM/YYYY format
    var currentTime = L.control({position: 'bottomleft'});

    map.timeDimension.on('timeload', function(data) {
      var getcurrentTime = map.timeDimension.getCurrentTime();
      var dateCurrentTime = new Date(getcurrentTime);
      var options = dateCurrentTime.toLocaleDateString();
      currentTime.onAdd = function (map){
        var div = L.DomUtil.create('div', 'yearbox');
        div.innerHTML += '<h1>' + options + '</h1> '
        return div;
      };
    currentTime.addTo(map);
    });

   </script>
</body>
</html>
